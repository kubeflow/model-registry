name: Welcome first-time contributors (Beta2)

on:
  pull_request:
    types: 
      - opened
      - synchronize
      - reopened
  issues:
    types:
      - opened

permissions: # set contents: read at top-level, per OpenSSF ScoreCard rule TokenPermissionsID
  contents: read

jobs:
  welcome:
    # do NOT skip the entire workflow as that generates troubles with Prow/Tide, i.e. do not do `if` checks here
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      issues: write
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Install PyYAML
        run: pip3 install pyyaml

      - name: Extract approvers from OWNERS file
        id: set-approvers
        run: |
          python3 << 'EOF'
          import yaml
          import os
          
          with open('OWNERS', 'r') as f:
              data = yaml.safe_load(f)
          
          approvers = data.get('approvers', [])
          result = ' '.join([f'@{approver}' for approver in approvers])
          
          with open(os.environ['GITHUB_OUTPUT'], 'a') as f:
              f.write(f'approvers={result}\n')
          
          print(f'Extracted approvers: {result}')
          EOF
      - name: Log approvers
        run: |
          echo "Approvers: ${{ steps.set-approvers.outputs.approvers }}"

      - name: Welcome first-time contributors message
        if: ${{ github.actor != 'dependabot[bot]' }}
        uses: actions/first-interaction@v3
        continue-on-error: true
        with:
          issue_message: |
            ðŸŽ‰ **Welcome to the Kubeflow Model Registry!** ðŸŽ‰
            Thanks for opening your first issue! We're happy to have you as part of our community ðŸš€

            **Here's what happens next:**
            - If you'd like to contribute to this issue, check out our [Contributing Guide](https://github.com/kubeflow/model-registry/blob/main/CONTRIBUTING.md) for repo-specific guidelines and the [Kubeflow Contributor Guide](https://www.kubeflow.org/docs/about/contributing/) for general community standards
            - Our team will review your issue soon!

            **Join the community:**
            - **Slack**: Join our [Slack channels](https://www.kubeflow.org/docs/about/community/#slack-channels)
            - **Meetings**: Attend the [Kubeflow](https://www.kubeflow.org/docs/about/community/#list-of-available-meetings) online calls

            Feel free to ask questions in the comments if you need any help or clarification!
            Thanks again for contributing to Kubeflow! ðŸ™
          pr_message: |
            ðŸŽ‰ **Welcome to the Kubeflow Model Registry!** ðŸŽ‰
            Thanks for opening your first PR! We're happy to have you as part of our community ðŸš€

            **Here's what happens next:**
            - If you haven't already, please check out our [Contributing Guide](https://github.com/kubeflow/model-registry/blob/main/CONTRIBUTING.md) for repo-specific guidelines and the [Kubeflow Contributor Guide](https://www.kubeflow.org/docs/about/contributing/) for general community standards
            - Our team will review your PR soon!

            **Join the community:**
            - **Slack**: Join our [Slack channels](https://www.kubeflow.org/docs/about/community/#slack-channels)
            - **Meetings**: Attend the [Kubeflow](https://www.kubeflow.org/docs/about/community/#list-of-available-meetings) online calls

            Feel free to ask questions in the comments if you need any help or clarification!
            Thanks again for contributing to Kubeflow! ðŸ™

            Note for: ${{ steps.set-approvers.outputs.approvers }}
            Kindly ensure the label `ok-to-test` has been added to the PR, and all the tests have been executed before merging!
